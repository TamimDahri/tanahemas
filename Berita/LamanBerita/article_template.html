<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title id="page-title">Loading Article...</title>

  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Showdown (Markdown -> HTML) -->
  <script src="https://cdn.jsdelivr.net/npm/showdown@2.1.0/dist/showdown.min.js"></script>

  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#182B49',
            secondary: '#D4A762',
            accent: '#F7F7F7',
            'dark-bg': '#0D1A2E',
          },
          fontFamily: {
            sans: ['Inter', 'sans-serif'],
          }
        }
      }
    };
  </script>

  <style>
    /* ---- DO NOT use @apply here; CDN Tailwind won't process it ---- */

    /* Markdown typography */
    .markdown-content h1{
      font-size: 2.25rem; /* text-4xl */
      font-weight: 800;
      color: #182B49;
      margin-bottom: 1.5rem;
      padding-top: 1rem;
      border-bottom: 1px solid rgba(212,167,98,0.5);
    }
    .markdown-content h2{
      font-size: 1.875rem; /* text-3xl */
      font-weight: 700;
      color: #182B49;
      margin-top: 2rem;
      margin-bottom: 1rem;
      border-left: 4px solid #D4A762;
      padding-left: 0.75rem;
    }
    .markdown-content p{
      font-size: 1.125rem; /* text-lg */
      color: #374151;      /* gray-700 */
      line-height: 1.9;    /* loose */
      margin: 1.75rem 0;   /* vertical spacing between paragraphs */
    }
    .markdown-content strong{
      color: #182B49;
      font-weight: 600;
    }
    .markdown-content ul{
      list-style: disc;
      padding-left: 1.5rem; /* similar to ml-6 */
      margin-bottom: 2rem;
    }
    .markdown-content li{
      margin-bottom: 0.5rem;
      color: #4B5563; /* gray-600 */
    }
    .markdown-content blockquote{
      border-left: 4px solid #D4A762;
      background: #F9FAFB;  /* gray-50 */
      padding: 1rem;
      font-style: italic;
      color: #1F2937;       /* gray-800 */
      border-radius: 0.5rem;
      margin: 2.5rem 0;
    }
    /* Optional: make <br> create visible extra space */
    .markdown-content br{
      display: block;
      content: "";
      margin-bottom: 1rem;
    }

    /* Article hero image polish */
    #article-image-container img{
      border-radius: 1rem;
      box-shadow: 0 10px 20px rgba(0,0,0,0.15);
    }
  </style>
</head>

<body class="bg-accent font-sans min-h-screen">
  <!-- Header -->
  <header class="bg-primary shadow-lg">
    <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 h-16 flex items-center justify-between">
      <a href="../index.html" class="text-xl font-extrabold text-white tracking-widest hover:text-secondary transition">
        &larr; BACK TO NEWS
      </a>
      <span class="text-secondary font-bold text-xl">TANAHEMAS</span>
    </div>
  </header>

  <main class="py-12">
    <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 bg-white p-6 md:p-10 rounded-2xl shadow-xl">
      <!-- Article Header -->
      <div id="article-header" class="mb-8">
        <p id="article-category" class="text-sm font-semibold text-secondary uppercase tracking-wider mb-2">Category</p>
        <h1 id="article-title" class="text-5xl font-extrabold text-primary mb-4">Title Loading...</h1>
        <p id="article-description" class="text-xl text-gray-600 mb-6 font-light">Short description loading...</p>
        <div id="article-meta" class="text-gray-500 text-sm flex items-center gap-4 border-t pt-4">
          <span>Oleh: <strong class="text-primary">Media Tanahemas</strong></span>
          <span id="article-date">Loading...</span>
        </div>
      </div>

      <!-- Hero Image -->
      <div id="article-image-container" class="mb-10">
        <img src="image.png" alt="Article main image" class="w-full h-auto object-cover transition-all duration-500">
      </div>

      <!-- Markdown Content -->
      <div class="pt-4">
        <div id="article-content" class="markdown-content">
          <p class="text-center text-gray-500 py-10">
            <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-primary inline-block" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
              <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
              <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
            </svg>
            Memuatkan kandungan artikel...
          </p>
        </div>
      </div>

      <!-- Share -->
      <div class="mt-10 pt-6 border-t border-gray-200 flex justify-between items-center">
        <p class="text-sm text-gray-600 font-medium">Share This Article:</p>
        <div class="flex space-x-3">
          <button class="text-gray-400 hover:text-primary transition" aria-label="Share to Twitter">
            <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24"><path d="M22.05 4.607c-.77.34-1.594.57-2.457.674.887-.53 1.57-1.376 1.89-2.383-.827.49-1.748.84-2.73.992-.78-1.04-1.88-1.69-3.11-1.69-2.35 0-4.26 1.91-4.26 4.26 0 .335.037.66.11.97-3.54-.18-6.68-1.87-8.78-4.43-.365.63-.574 1.37-.574 2.16 0 1.47.747 2.77 1.88 3.53-.69-.022-1.34-.21-1.9-.53v.05c0 2.06 1.47 3.78 3.42 4.18-.35.1-.72.15-1.1.15-.27 0-.53-.026-.79-.08.54 1.7 2.11 2.94 3.97 2.98C6.9 17.18 5.23 18 3.48 18c-.34 0-.68-.02-1.01-.06 1.89 1.2 4.14 1.9 6.57 1.9 7.88 0 12.18-6.52 12.18-12.18 0-.18 0-.36-.01-.54.83-.6 1.55-1.34 2.12-2.19z"/></svg>
          </button>
          <button class="text-gray-400 hover:text-primary transition" aria-label="Share to LinkedIn">
            <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24"><path d="M19 3H5a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2V5a2 2 0 00-2-2zM8.6 15.6H6.1v-8h2.5v8zM7.35 6.91a1.27 1.27 0 01-1.28-1.28c0-.71.57-1.28 1.28-1.28s1.28.57 1.28 1.28c0 .71-.57 1.28-1.28 1.28zM18 15.6h-2.34v-2.35c0-.57-.01-1.3-.79-1.3s-1.02.6-1.02 1.28v2.37H12.5v-8h2.34v1.02h.03c.33-.63 1.15-1.28 2.21-1.28 2.37 0 2.81 1.56 2.81 3.58v4.68z"/></svg>
          </button>
        </div>
      </div>

      <!-- Back -->
      <div class="mt-12 text-center">
        <a href="../index.html" class="inline-flex items-center bg-primary text-white font-bold px-8 py-3 rounded-full text-base shadow-lg hover:bg-dark-bg transition">
          &larr; Return to News Listings
        </a>
      </div>
    </div>
  </main>

  <footer class="bg-dark-bg h-16 w-full mt-10"></footer>

  <script>
    function getUrlParameter(name){
      name = name.replace(/[\[]/, '\\[').replace(/[\]]/, '\\]');
      var regex = new RegExp('[\\?&]' + name + '=([^&#]*)');
      var results = regex.exec(location.search);
      return results === null ? '' : decodeURIComponent(results[1].replace(/\+/g, ' '));
    }

    async function loadAndRenderArticle(){
      const contentFileName = getUrlParameter('source');
      const articleContentDiv = document.getElementById('article-content');
      const articleImage = document.querySelector('#article-image-container img');

      if (!contentFileName){
        articleContentDiv.innerHTML = '<p class="text-red-500 text-xl text-center">Error: No content source specified in URL.</p>';
        document.getElementById('article-title').textContent = 'Error';
        document.getElementById('page-title').textContent = 'Error | Tanahemas';
        return;
      }

      try{
        // 1) Load Markdown
        const response = await fetch(contentFileName);
        if (!response.ok) throw new Error('Failed to load Markdown file: ' + contentFileName);
        const markdownText = await response.text();

        // 2) Load metadata (optional; keep if you use news_data.json)
        const metadataResponse = await fetch('../news_data.json').catch(()=>null);
        if (metadataResponse && metadataResponse.ok){
          const newsData = await metadataResponse.json();
          const metadata = newsData.find(i => i.contentSource === contentFileName);
          if (metadata){
            document.getElementById('article-category').textContent = metadata.category || 'News';
            document.getElementById('article-title').textContent = metadata.title || 'Untitled';
            document.getElementById('article-description').textContent = metadata.description || '';
            document.getElementById('article-date').textContent = metadata.date || '';
            document.getElementById('page-title').textContent = (metadata.title || 'Article') + ' | Tanahemas';
          }
        }

        // 3) Convert Markdown -> HTML
        const converter = new showdown.Converter({
          // keep default paragraph behavior (blank line => <p>)
          simpleLineBreaks: false,
          tables: true,
          tasklists: true,
          smartIndentationFix: true,
          literalMidWordUnderscores: true
        });

        const htmlContent = converter.makeHtml(markdownText);
        articleContentDiv.innerHTML = htmlContent;

      }catch(err){
        console.error(err);
        articleContentDiv.innerHTML = `<p class="text-red-500 text-xl text-center">Ralat: Gagal memuatkan artikel penuh. Sila pastikan fail Markdown (${contentFileName}) wujud.</p>`;
        document.getElementById('article-title').textContent = 'Content Not Found';
        document.getElementById('page-title').textContent = 'Content Not Found | Tanahemas';
      }
    }

    window.onload = loadAndRenderArticle;
  </script>
</body>
</html>
